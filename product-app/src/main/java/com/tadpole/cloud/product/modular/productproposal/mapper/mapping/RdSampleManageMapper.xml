<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tadpole.cloud.product.modular.productproposal.mapper.RdSampleManageMapper">
    <select id="listPage" resultType="com.tadpole.cloud.product.api.productproposal.model.result.RdSampleManageResult">
        SELECT
            t2.SYS_TS_TASK_NAME,t2.SYS_TS_SAMPLE_METHOD,t2.SYS_TS_LOGO_DES_POS,t2.SYS_TS_DEV_BRAND,
            t3.SYS_DEV_METHOND,t3.SYS_TA_LEVEL,t3.SYS_TA_PA_DATE,t3.SYS_TA_STATUS,t3.SYS_TA_ARCH_DATE,
            t5.SYS_PRO_NAME,t5.SYS_STYLE,t5.SYS_MAIN_MATERIAL,t5.SYS_BRAND,t5.SYS_MODEL,t5.SYS_PM_PER_CODE,t5.SYS_PM_PER_NAME,
            t4.SYS_PL_NAME,t4.SYS_SHORT_CODE,t4.SYS_PM_PER_CODE SYS_PL_PM_PER_CODE,t4.SYS_PM_PER_NAME SYS_PL_PM_PER_NAME,
            CASE
            WHEN t6.SYS_FEE_APP_CODE IS NOT NULL THEN t6.SYS_FEE_APP_TOTAL_FEE
            WHEN t7.SYS_FEE_APP_CODE IS NOT NULL THEN t7.SYS_CF_FEE_TOTAL
            ELSE
                NULL
            END AS SYS_FEE_APP_TOTAL_FEE,
            t1.*
        FROM RD_SAMPLE_MANAGE t1
        JOIN RD_SAMPLE_TASK t2 ON t1.SYS_TS_TASK_CODE=t2.SYS_TS_TASK_CODE
        JOIN RD_PROPOSAL t3 ON t1.SYS_TA_CODE=t3.SYS_TA_CODE
        JOIN RD_PL_MANAGE t4 ON t1.SYS_PL_CODE=t4.SYS_PL_CODE
        JOIN RD_PSS_MANAGE t5 ON t1.SYS_PL_CODE=t5.SYS_PL_CODE AND t1.SYS_SPU=t5.SYS_SPU
        LEFT JOIN (SELECT SYS_FEE_APP_CODE,SYS_FEE_APP_TOTAL_FEE FROM RD_SAMPLE_PA) t6 ON t1.SYS_KFY_FEE_CODE=t6.SYS_FEE_APP_CODE AND t1.SYS_KFY_FEE_SOURCE='购样申请'
        LEFT JOIN (SELECT B.SYS_FEE_APP_CODE,A.SYS_CF_FEE_TOTAL FROM RD_SAMPLE_CFB A JOIN RD_SAMPLE_CA B ON A.SYS_CUST_FEBK_CODE=B.SYS_CUST_FEBK_CODE) t7 ON t1.SYS_KFY_FEE_CODE=t6.SYS_FEE_APP_CODE AND t1.SYS_KFY_FEE_SOURCE='定制申请'
        where 1=1
          AND t1.SYS_KFY_REC_DATE IS NOT NULL --AND t1.SYS_KFY_LOST_OP_DATE IS NULL AND t1.SYS_KFY_PUR_DEST_DATE IS NULL AND t1.SYS_KFY_RG_OP_DATE IS NULL
              --t1.SYS_KFY_STATUS IN ('待处置','已退货','已销毁','已报失','已封存','领用中','已接收')
            <if test="paramCondition.sysKfyCode != null and paramCondition.sysKfyCode != ''">
                AND t1.SYS_KFY_CODE = #{paramCondition.sysKfyCode}
            </if>
            <if test="paramCondition.sysKfySampleName != null and paramCondition.sysKfySampleName != ''">
                AND t1.SYS_KFY_SAMPLE_NAME = #{paramCondition.sysKfySampleName}
            </if>
            <if test="paramCondition.sysKfyCodeList != null and paramCondition.sysKfyCodeList.size() > 0">
                AND t1.SYS_KFY_CODE in
                <foreach collection="paramCondition.sysKfyCodeList" item="item" index="index" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="paramCondition.sysKfyScList != null and paramCondition.sysKfyScList.size() > 0">
                AND t1.SYS_KFY_SC in
                <foreach collection="paramCondition.sysKfyScList" item="item" index="index" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="paramCondition.sysKfyStatusList != null and paramCondition.sysKfyStatusList.size() > 0">
                AND t1.SYS_KFY_STATUS in
                <foreach collection="paramCondition.sysKfyStatusList" item="item" index="index" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
        ORDER BY t1.SYS_KFY_CODE DESC
    </select>

    <select id="listTestSample" resultType="com.tadpole.cloud.product.api.productproposal.model.result.RdSampleManageResult">
        SELECT
        t2.SYS_TS_TASK_NAME,t2.SYS_TS_SAMPLE_METHOD,t2.SYS_TS_LOGO_DES_POS,t2.SYS_TS_DEV_BRAND,
        t3.SYS_DEV_METHOND,t3.SYS_TA_LEVEL,t3.SYS_TA_PA_DATE,t3.SYS_TA_STATUS,t3.SYS_TA_ARCH_DATE,
        t5.SYS_PRO_NAME,t5.SYS_STYLE,t5.SYS_MAIN_MATERIAL,t5.SYS_BRAND,t5.SYS_MODEL,t5.SYS_PM_PER_CODE,t5.SYS_PM_PER_NAME,
        t4.SYS_PL_NAME,t4.SYS_SHORT_CODE,t4.SYS_PM_PER_CODE SYS_PL_PM_PER_CODE,t4.SYS_PM_PER_NAME SYS_PL_PM_PER_NAME,
        CASE
        WHEN t6.SYS_FEE_APP_CODE IS NOT NULL THEN t6.SYS_FEE_APP_TOTAL_FEE
        WHEN t7.SYS_FEE_APP_CODE IS NOT NULL THEN t7.SYS_CF_FEE_TOTAL
        ELSE
        NULL
        END AS SYS_FEE_APP_TOTAL_FEE,
        t1.*
        FROM RD_SAMPLE_MANAGE t1
        JOIN RD_SAMPLE_TASK t2 ON t1.SYS_TS_TASK_CODE=t2.SYS_TS_TASK_CODE
        JOIN RD_PROPOSAL t3 ON t1.SYS_TA_CODE=t3.SYS_TA_CODE
        JOIN RD_PL_MANAGE t4 ON t1.SYS_PL_CODE=t4.SYS_PL_CODE
        JOIN RD_PSS_MANAGE t5 ON t1.SYS_PL_CODE=t5.SYS_PL_CODE AND t1.SYS_SPU=t5.SYS_SPU
        LEFT JOIN (SELECT SYS_FEE_APP_CODE,SYS_FEE_APP_TOTAL_FEE FROM RD_SAMPLE_PA) t6 ON t1.SYS_KFY_FEE_CODE=t6.SYS_FEE_APP_CODE AND t1.SYS_KFY_FEE_SOURCE='购样申请'
        LEFT JOIN (SELECT B.SYS_FEE_APP_CODE,A.SYS_CF_FEE_TOTAL FROM RD_SAMPLE_CFB A JOIN RD_SAMPLE_CA B ON A.SYS_CUST_FEBK_CODE=B.SYS_CUST_FEBK_CODE) t7 ON t1.SYS_KFY_FEE_CODE=t6.SYS_FEE_APP_CODE AND t1.SYS_KFY_FEE_SOURCE='定制申请'
        where 1=1 AND t1.SYS_KFY_STATUS NOT IN ('待提交')
        <if test="paramCondition.sysKfyCode != null and paramCondition.sysKfyCode != ''">
            AND t1.SYS_KFY_CODE = #{paramCondition.sysKfyCode}
        </if>
        <if test="paramCondition.sysKfySampleName != null and paramCondition.sysKfySampleName != ''">
            AND t1.SYS_KFY_SAMPLE_NAME = #{paramCondition.sysKfySampleName}
        </if>
        <if test="paramCondition.sysTsTaskCode != null and paramCondition.sysTsTaskCode != ''">
            AND t1.SYS_TS_TASK_CODE = #{paramCondition.sysTsTaskCode}
        </if>
        <if test="paramCondition.sysKfyCodeList != null and paramCondition.sysKfyCodeList.size() > 0">
            AND t1.SYS_KFY_CODE in
            <foreach collection="paramCondition.sysKfyCodeList" item="item" index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="paramCondition.sysKfyScList != null and paramCondition.sysKfyScList.size() > 0">
            AND t1.SYS_KFY_SC in
            <foreach collection="paramCondition.sysKfyScList" item="item" index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="paramCondition.sysKfyStatusList != null and paramCondition.sysKfyStatusList.size() > 0">
            AND t1.SYS_KFY_STATUS in
            <foreach collection="paramCondition.sysKfyStatusList" item="item" index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        ORDER BY t1.SYS_KFY_CODE DESC
    </select>

    <select id="listSample" resultType="com.tadpole.cloud.product.api.productproposal.model.result.RdSampleManageResult">
        SELECT
        t2.SYS_TS_TASK_NAME,t2.SYS_TS_SAMPLE_METHOD,t2.SYS_TS_LOGO_DES_POS,t2.SYS_TS_DEV_BRAND,
        t3.SYS_DEV_METHOND,t3.SYS_TA_LEVEL,t3.SYS_TA_PA_DATE,t3.SYS_TA_STATUS,t3.SYS_TA_ARCH_DATE,
        t5.SYS_PRO_NAME,t5.SYS_STYLE,t5.SYS_MAIN_MATERIAL,t5.SYS_BRAND,t5.SYS_MODEL,t5.SYS_PM_PER_CODE,t5.SYS_PM_PER_NAME,
        t4.SYS_PL_NAME,t4.SYS_SHORT_CODE,t4.SYS_PM_PER_CODE SYS_PL_PM_PER_CODE,t4.SYS_PM_PER_NAME SYS_PL_PM_PER_NAME,
        CASE
        WHEN t6.SYS_FEE_APP_CODE IS NOT NULL THEN t6.SYS_FEE_APP_TOTAL_FEE
        WHEN t7.SYS_FEE_APP_CODE IS NOT NULL THEN t7.SYS_CF_FEE_TOTAL
        ELSE
            NULL
        END AS SYS_FEE_APP_TOTAL_FEE,
        t1.*
        FROM RD_SAMPLE_MANAGE t1
        JOIN RD_SAMPLE_TASK t2 ON t1.SYS_TS_TASK_CODE=t2.SYS_TS_TASK_CODE
        JOIN RD_PROPOSAL t3 ON t1.SYS_TA_CODE=t3.SYS_TA_CODE
        JOIN RD_PL_MANAGE t4 ON t1.SYS_PL_CODE=t4.SYS_PL_CODE
        JOIN RD_PSS_MANAGE t5 ON t1.SYS_PL_CODE=t5.SYS_PL_CODE AND t1.SYS_SPU=t5.SYS_SPU
        LEFT JOIN (SELECT SYS_FEE_APP_CODE,SYS_FEE_APP_TOTAL_FEE FROM RD_SAMPLE_PA) t6 ON t1.SYS_KFY_FEE_CODE=t6.SYS_FEE_APP_CODE AND t1.SYS_KFY_FEE_SOURCE='购样申请'
        LEFT JOIN (SELECT B.SYS_FEE_APP_CODE,A.SYS_CF_FEE_TOTAL FROM RD_SAMPLE_CFB A JOIN RD_SAMPLE_CA B ON A.SYS_CUST_FEBK_CODE=B.SYS_CUST_FEBK_CODE) t7 ON t1.SYS_KFY_FEE_CODE=t6.SYS_FEE_APP_CODE AND t1.SYS_KFY_FEE_SOURCE='定制申请'
        where 1=1
          AND t1.SYS_KFY_STATUS IN ('待提交','待开发领用','测评中','待归还','待处置')
        <if test="paramCondition.sysTaCode != null and paramCondition.sysTaCode != ''">
            AND t1.SYS_TA_CODE = #{paramCondition.sysTaCode}
        </if>
        <if test="paramCondition.sysTsTaskCode != null and paramCondition.sysTsTaskCode != ''">
            AND t1.SYS_TS_TASK_CODE = #{paramCondition.sysTsTaskCode}
        </if>
        <if test="paramCondition.sysKfyStatus != null and paramCondition.sysKfyStatus != ''">
            AND t1.SYS_KFY_STATUS = #{paramCondition.sysKfyStatus}
        </if>
        <if test="paramCondition.sysKfyLableStatus != null and paramCondition.sysKfyLableStatus != ''">
            AND t1.SYS_KFY_LABLE_STATUS = #{paramCondition.sysKfyLableStatus}
        </if>
        <if test="paramCondition.sysKfyStatusList != null and paramCondition.sysKfyStatusList.size() > 0">
            AND t1.SYS_KFY_STATUS in
            <foreach collection="paramCondition.sysKfyStatusList" item="item" index="index" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>

    </select>

    <select id="detail" resultType="com.tadpole.cloud.product.api.productproposal.model.result.RdSampleManageResult">
        SELECT
        t2.SYS_TS_TASK_NAME,t2.SYS_TS_SAMPLE_METHOD,t2.SYS_TS_LOGO_DES_POS,t2.SYS_TS_DEV_BRAND,
        t3.SYS_DEV_METHOND,t3.SYS_TA_LEVEL,t3.SYS_TA_PA_DATE,t3.SYS_TA_STATUS,t3.SYS_TA_ARCH_DATE,
        t5.SYS_PRO_NAME,t5.SYS_STYLE,t5.SYS_MAIN_MATERIAL,t5.SYS_BRAND,t5.SYS_MODEL,t5.SYS_PM_PER_CODE,t5.SYS_PM_PER_NAME,
        t4.SYS_PL_NAME,t4.SYS_SHORT_CODE,t4.SYS_PM_PER_CODE SYS_PL_PM_PER_CODE,t4.SYS_PM_PER_NAME SYS_PL_PM_PER_NAME,
        t1.*
        FROM RD_SAMPLE_MANAGE t1
        JOIN RD_SAMPLE_TASK t2 ON t1.SYS_TS_TASK_CODE=t2.SYS_TS_TASK_CODE
        JOIN RD_PROPOSAL t3 ON t1.SYS_TA_CODE=t3.SYS_TA_CODE
        JOIN RD_PL_MANAGE t4 ON t1.SYS_PL_CODE=t4.SYS_PL_CODE
        JOIN RD_PSS_MANAGE t5 ON t1.SYS_PL_CODE=t5.SYS_PL_CODE AND t1.SYS_SPU=t5.SYS_SPU
        LEFT JOIN (SELECT SYS_FEE_APP_CODE,SYS_FEE_APP_TOTAL_FEE FROM RD_SAMPLE_PA) t6 ON t1.SYS_KFY_FEE_CODE=t6.SYS_FEE_APP_CODE AND t1.SYS_KFY_FEE_SOURCE='购样申请'
        LEFT JOIN (SELECT B.SYS_FEE_APP_CODE,A.SYS_CF_FEE_TOTAL FROM RD_SAMPLE_CFB A JOIN RD_SAMPLE_CA B ON A.SYS_CUST_FEBK_CODE=B.SYS_CUST_FEBK_CODE) t7 ON t1.SYS_KFY_FEE_CODE=t6.SYS_FEE_APP_CODE AND t1.SYS_KFY_FEE_SOURCE='定制申请'
        where 1=1
        <if test="paramCondition.sysKfyCode != null and paramCondition.sysKfyCode != ''">
            AND t1.SYS_KFY_CODE = #{paramCondition.sysKfyCode}
        </if>

    </select>

    <select id="listSampleManage" resultType="com.tadpole.cloud.product.api.productproposal.model.result.RdSampleManageResult">
        SELECT
        t2.SYS_TS_TASK_NAME,t2.SYS_TS_SAMPLE_METHOD,t2.SYS_TS_LOGO_DES_POS,t2.SYS_TS_DEV_BRAND,
        t3.SYS_DEV_METHOND,t3.SYS_TA_LEVEL,t3.SYS_TA_PA_DATE,t3.SYS_TA_STATUS,t3.SYS_TA_ARCH_DATE,
        t5.SYS_PRO_NAME,t5.SYS_STYLE,t5.SYS_MAIN_MATERIAL,t5.SYS_BRAND,t5.SYS_MODEL,t5.SYS_PM_PER_CODE,t5.SYS_PM_PER_NAME,
        t4.SYS_PL_NAME,t4.SYS_SHORT_CODE,t4.SYS_PM_PER_CODE SYS_PL_PM_PER_CODE,t4.SYS_PM_PER_NAME SYS_PL_PM_PER_NAME,
        CASE
        WHEN t6.SYS_FEE_APP_CODE IS NOT NULL THEN t6.SYS_FEE_APP_TOTAL_FEE
        WHEN t7.SYS_FEE_APP_CODE IS NOT NULL THEN t7.SYS_CF_FEE_TOTAL
        ELSE
        NULL
        END AS SYS_FEE_APP_TOTAL_FEE,
        t1.*
        FROM RD_SAMPLE_MANAGE t1
        JOIN RD_SAMPLE_TASK t2 ON t1.SYS_TS_TASK_CODE=t2.SYS_TS_TASK_CODE
        JOIN RD_PROPOSAL t3 ON t1.SYS_TA_CODE=t3.SYS_TA_CODE
        JOIN RD_PL_MANAGE t4 ON t1.SYS_PL_CODE=t4.SYS_PL_CODE
        JOIN RD_PSS_MANAGE t5 ON t1.SYS_PL_CODE=t5.SYS_PL_CODE AND t1.SYS_SPU=t5.SYS_SPU
        LEFT JOIN (SELECT SYS_FEE_APP_CODE,SYS_FEE_APP_TOTAL_FEE FROM RD_SAMPLE_PA) t6 ON t1.SYS_KFY_FEE_CODE=t6.SYS_FEE_APP_CODE AND t1.SYS_KFY_FEE_SOURCE='购样申请'
        LEFT JOIN (SELECT B.SYS_FEE_APP_CODE,A.SYS_CF_FEE_TOTAL FROM RD_SAMPLE_CFB A JOIN RD_SAMPLE_CA B ON A.SYS_CUST_FEBK_CODE=B.SYS_CUST_FEBK_CODE) t7 ON t1.SYS_KFY_FEE_CODE=t6.SYS_FEE_APP_CODE AND t1.SYS_KFY_FEE_SOURCE='定制申请'
        where 1=1 AND t1.SYS_KFY_FEBK_IS_VALID IS NOT NULL
        <if test="paramCondition.sysTaCode != null and paramCondition.sysTaCode != ''">
            AND t1.SYS_TA_CODE = #{paramCondition.sysTaCode}
        </if>
        <if test="paramCondition.sysTsTaskCode != null and paramCondition.sysTsTaskCode != ''">
            AND t1.SYS_TS_TASK_CODE = #{paramCondition.sysTsTaskCode}
        </if>

        ORDER BY t1.SYS_KFY_CODE DESC
    </select>

</mapper>
